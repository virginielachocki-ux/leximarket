<!-- index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexiMarket - Jeu de Vocabulaire Marketing BTS MCO</title>
    <!-- Copiez exactement tout le contenu de l'artifact pr√©c√©dent ici -->
</head>
<body>
    <!<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexiMarket - Jeu de Vocabulaire Marketing BTS MCO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 900px;
            width: 90%;
            min-height: 600px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .admin-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .login-form, .lobby-form, .admin-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            width: auto;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .game-modes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-mode {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-mode:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .game-mode h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .game-mode p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .queue-status {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .queue-timer {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .room-info {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .room-code {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
            letter-spacing: 3px;
        }

        .waiting-message {
            color: #666;
            font-style: italic;
            margin: 10px 0;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .player {
            text-align: center;
        }

        .player h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .player .score {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .current-turn {
            background: #d4edda !important;
            border-left: 4px solid #28a745;
        }

        .game-area {
            text-align: center;
            margin-bottom: 30px;
        }

        .word-to-guess {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 12px;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        .word-hidden {
            background: #e1e5e9;
            color: #666;
        }

        .timer {
            font-size: 48px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 20px;
        }

        .timer.warning {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .clues-section, .guess-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .clues-list {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .clue {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
        }

        .bot-clue {
            background: #28a745;
        }

        .turns-left {
            font-size: 18px;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .difficulty-display {
            margin-bottom: 20px;
            font-weight: bold;
        }

        .difficulty-easy { color: #28a745; }
        .difficulty-medium { color: #fd7e14; }
        .difficulty-hard { color: #dc3545; }

        .results {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .score-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .word-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .word-item {
            background: #f8f9fa;
            margin-bottom: 15px;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e1e5e9;
        }

        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .word-text {
            font-weight: bold;
            color: #333;
            font-size: 18px;
        }

        .word-definition {
            color: #666;
            margin-bottom: 10px;
            font-style: italic;
        }

        .word-clues {
            background: white;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }

        .word-clues h5 {
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .clue-input-row {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }

        .clue-input-small {
            flex: 1;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .word-difficulty {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .export-import {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .export-import h4 {
            margin-bottom: 10px;
            color: #856404;
        }

        .leaderboard {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .user-stats {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            text-align: center;
            background: white;
            padding: 10px;
            border-radius: 6px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }
            
            .player-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .score-breakdown, .game-modes {
                grid-template-columns: 1fr;
            }

            .admin-btn {
                position: relative;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üéØ LexiMarket</h1>
            <p>Jeu coop√©ratif de vocabulaire marketing pour BTS MCO</p>
            <button class="admin-btn" onclick="showAdminPanel()">‚öôÔ∏è Admin</button>
        </div>

        <!-- √âcran de connexion -->
        <div class="screen active" id="loginScreen">
            <div class="login-form">
                <h2 style="text-align: center; margin-bottom: 20px;">Connexion</h2>
                
                <div class="form-group">
                    <label for="userName">Pseudo :</label>
                    <input type="text" id="userName" placeholder="Votre pseudo">
                </div>
                
                <div class="form-group">
                    <label for="userPassword">Mot de passe :</label>
                    <input type="password" id="userPassword" placeholder="Votre mot de passe">
                </div>
                
                <div class="form-group">
                    <label for="userEmail">Email (optionnel) :</label>
                    <input type="email" id="userEmail" placeholder="votre@email.com">
                </div>
                
                <button class="btn" onclick="login()">Se connecter</button>
                <button class="btn btn-secondary" onclick="register()">Cr√©er un compte</button>
                
                <div class="leaderboard" id="loginLeaderboard">
                    <h3>üèÜ Classement</h3>
                    <div id="leaderboardList"></div>
                </div>
            </div>
        </div>

        <!-- √âcran du lobby -->
        <div class="screen" id="lobbyScreen">
            <div class="lobby-form">
                <h2>Bienvenue, <span id="currentPlayerName"></span>!</h2>
                
                <div class="user-stats">
                    <h4>üìä Vos statistiques</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="userTotalScore">0</div>
                            <div class="stat-label">Points</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="userGamesPlayed">0</div>
                            <div class="stat-label">Parties</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="userWordsGuessed">0</div>
                            <div class="stat-label">Mots trouv√©s</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="userWinRate">0%</div>
                            <div class="stat-label">Taux r√©ussite</div>
                        </div>
                    </div>
                </div>
                
                <div class="game-modes">
                    <div class="game-mode" onclick="startTraining()">
                        <h3>ü§ñ Entra√Ænement</h3>
                        <p>Jouez contre l'IA pour vous entra√Æner</p>
                        <button class="btn btn-warning btn-small">Commencer</button>
                    </div>
                    
                    <div class="game-mode" onclick="startMatchmaking()">
                        <h3>‚ö° Matchmaking</h3>
                        <p>Trouvez un adversaire automatiquement</p>
                        <button class="btn btn-success btn-small">Chercher</button>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <h3>üè† Salles priv√©es</h3>
                    <div class="form-group">
                        <input type="text" id="roomCodeInput" placeholder="Code de salle (pour rejoindre)" style="max-width: 200px; margin: 0 auto;">
                    </div>
                    <button class="btn btn-secondary" onclick="createRoom()">Cr√©er une salle</button>
                    <button class="btn btn-secondary" onclick="joinRoom()">Rejoindre</button>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-small btn-secondary" onclick="logout()">D√©connexion</button>
                </div>
            </div>
        </div>

        <!-- √âcran de matchmaking -->
        <div class="screen" id="matchmakingScreen">
            <div class="queue-status">
                <h2>üîç Recherche d'adversaire...</h2>
                <div class="queue-timer" id="queueTimer">0:00</div>
                <p>Joueurs en file d'attente : <span id="queueCount">1</span></p>
                <div class="waiting-message">Veuillez patienter...</div>
                <button class="btn btn-danger btn-small" onclick="cancelMatchmaking()">Annuler</button>
            </div>
        </div>

        <!-- √âcran d'attente de salle -->
        <div class="screen" id="waitingScreen">
            <div class="room-info">
                <h2>Salle cr√©√©e !</h2>
                <div class="room-code" id="displayRoomCode">ABCD1234</div>
                <p>Partagez ce code avec votre partenaire</p>
                <div class="waiting-message">En attente du second joueur...</div>
                <button class="btn btn-secondary btn-small" onclick="backToLobby()">Retour</button>
            </div>
        </div>

        <!-- √âcran de jeu -->
        <div class="screen" id="gameScreen">
            <div class="player-info">
                <div class="player" id="player1Info">
                    <h3 id="player1Name">Joueur 1</h3>
                    <div class="score" id="player1Score">0</div>
                </div>
                <div class="player" id="player2Info">
                    <h3 id="player2Name">Joueur 2</h3>
                    <div class="score" id="player2Score">0</div>
                </div>
            </div>

            <div class="game-area">
                <div class="difficulty-display" id="difficultyDisplay"></div>
                <div class="timer" id="timer">60</div>
                <div class="word-to-guess" id="wordToGuess">SEGMENTATION</div>
                
                <div class="turns-left" id="turnsLeft">Tours restants : 4</div>
                
                <div class="clues-section" id="cluesSection">
                    <h3>Indices donn√©s :</h3>
                    <div class="clues-list" id="cluesList"></div>
                    
                    <div class="form-group" id="clueInputSection">
                        <input type="text" id="clueInput" placeholder="Donnez un indice (un seul mot)" maxlength="25">
                        <button class="btn btn-small" onclick="giveClue()">Donner l'indice</button>
                    </div>
                </div>

                <div class="guess-section" id="guessSection" style="display: none;">
                    <h3>√Ä vous de deviner !</h3>
                    <div class="form-group">
                        <input type="text" id="guessInput" placeholder="Votre r√©ponse">
                    </div>
                    <button class="btn btn-small btn-success" onclick="makeGuess()">Deviner</button>
                    <button class="btn btn-small" onclick="skipTurn()">Passer le tour</button>
                </div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-small btn-danger" onclick="endGame()">Abandonner</button>
            </div>
        </div>

        <!-- √âcran de r√©sultats -->
        <div class="screen" id="resultsScreen">
            <div class="results">
                <h2 id="resultTitle">Mot trouv√© !</h2>
                <p id="resultMessage">F√©licitations !</p>
                
                <div class="score-breakdown">
                    <div class="score-item">
                        <h4>Temps utilis√©</h4>
                        <p id="timeUsed">30s</p>
                    </div>
                    <div class="score-item">
                        <h4>Indices utilis√©s</h4>
                        <p id="cluesUsed">2/4</p>
                    </div>
                    <div class="score-item">
                        <h4>Bonus difficult√©</h4>
                        <p id="difficultyBonus">+50</p>
                    </div>
                    <div class="score-item">
                        <h4>Points gagn√©s</h4>
                        <p id="pointsEarned">150</p>
                    </div>
                </div>
                
                <button class="btn" onclick="nextRound()">Manche suivante</button>
                <button class="btn btn-small btn-secondary" onclick="backToLobby()">Retour au lobby</button>
            </div>
        </div>

        <!-- √âcran d'administration -->
        <div class="screen" id="adminScreen">
            <div class="admin-form">
                <h2>üîß Administration des mots</h2>
                
                <!-- Ajouter un mot -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3>‚ûï Ajouter un nouveau mot</h3>
                    <div class="form-group">
                        <label for="newWord">Mot :</label>
                        <input type="text" id="newWord" placeholder="Ex: SEGMENTATION" style="text-transform: uppercase;">
                    </div>
                    <div class="form-group">
                        <label for="newDefinition">D√©finition :</label>
                        <textarea id="newDefinition" placeholder="Ex: Division du march√© en groupes homog√®nes"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newDifficulty">Difficult√© :</label>
                        <select id="newDifficulty">
                            <option value="easy">Facile</option>
                            <option value="medium">Moyen</option>
                            <option value="hard">Difficile</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Indices pour le bot (4 indices) :</label>
                        <div class="clue-input-row">
                            <input type="text" id="newClue1" placeholder="Indice 1" class="clue-input-small">
                            <input type="text" id="newClue2" placeholder="Indice 2" class="clue-input-small">
                            <input type="text" id="newClue3" placeholder="Indice 3" class="clue-input-small">
                            <input type="text" id="newClue4" placeholder="Indice 4" class="clue-input-small">
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="addWord()">Ajouter le mot</button>
                </div>

                <!-- Export/Import -->
                <div class="export-import">
                    <h4>üìÅ Sauvegarde & Import</h4>
                    <button class="btn btn-small btn-secondary" onclick="exportWords()">Exporter la liste</button>
                    <div class="form-group" style="margin-top: 10px;">
                        <input type="file" id="importFile" accept=".json" style="padding: 5px;">
                        <button class="btn btn-small btn-secondary" onclick="importWords()">Importer</button>
                    </div>
                </div>

                <!-- Liste des mots -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h3>üìù Liste des mots (<span id="wordCount">0</span>)</h3>
                    <div class="word-list" id="wordList"></div>
                </div>

                <button class="btn btn-secondary" onclick="backToLogin()">Retour au jeu</button>
            </div>
        </div>
    </div>

    <script>
        // Base de donn√©es de vocabulaire marketing avec indices pour le bot
        let marketingVocabulary = JSON.parse(localStorage.getItem('leximarketWords') || JSON.stringify({
            easy: [
                { 
                    word: "MARQUE", 
                    definition: "Nom commercial d'un produit ou service",
                    botClues: ["logo", "nom", "entreprise", "identit√©"]
                },
                { 
                    word: "PRIX", 
                    definition: "Valeur mon√©taire demand√©e pour un bien",
                    botClues: ["co√ªt", "euros", "argent", "tarif"]
                },
                { 
                    word: "CLIENT", 
                    definition: "Personne qui ach√®te un produit ou service",
                    botClues: ["acheteur", "consommateur", "personne", "magasin"]
                },
                { 
                    word: "VENTE", 
                    definition: "Action de c√©der un bien contre paiement",
                    botClues: ["commerce", "transaction", "√©changer", "vendeur"]
                },
                { 
                    word: "PRODUIT", 
                    definition: "Bien ou service propos√© sur le march√©",
                    botClues: ["objet", "marchandise", "bien", "article"]
                }
            ],
            medium: [
                { 
                    word: "SEGMENTATION", 
                    definition: "Division du march√© en groupes homog√®nes",
                    botClues: ["diviser", "groupes", "cibler", "cat√©gories"]
                },
                { 
                    word: "POSITIONNEMENT", 
                    definition: "Place du produit dans l'esprit du consommateur",
                    botClues: ["image", "perception", "concurrence", "diff√©renciation"]
                },
                { 
                    word: "MERCHANDISING", 
                    definition: "Techniques de pr√©sentation des produits en magasin",
                    botClues: ["vitrine", "disposition", "pr√©sentation", "rayon"]
                },
                { 
                    word: "FIDELISATION", 
                    definition: "Strat√©gies pour fid√©liser la client√®le",
                    botClues: ["garder", "clients", "fid√®les", "programme"]
                },
                { 
                    word: "FRANCHISE", 
                    definition: "Contrat de distribution sous une enseigne",
                    botClues: ["r√©seau", "enseigne", "contrat", "licence"]
                }
            ],
            hard: [
                { 
                    word: "OMNICANALITE", 
                    definition: "Strat√©gie multicanale int√©gr√©e et coh√©rente",
                    botClues: ["canaux", "int√©gration", "coh√©rence", "multicanal"]
                },
                { 
                    word: "NEUROMARKETING", 
                    definition: "Application des neurosciences au marketing",
                    botClues: ["cerveau", "neurones", "psychologie", "comportement"]
                },
                { 
                    word: "RETARGETING", 
                    definition: "Reciblage publicitaire des visiteurs web",
                    botClues: ["publicit√©", "internet", "recibler", "visiteurs"]
                },
                { 
                    word: "CROSSELLING", 
                    definition: "Vente de produits compl√©mentaires",
                    botClues: ["compl√©mentaire", "suppl√©mentaire", "addition", "combinaison"]
                },
                { 
                    word: "STORYTELLING", 
                    definition: "Technique narrative en communication marketing",
                    botClues: ["histoire", "r√©cit", "narration", "√©motions"]
                }
            ]
        }));

        // Variables du jeu
        let currentUser = null;
        let currentRoom = null;
        let isTrainingMode = false;
        let gameState = {
            player1: { name: "", score: 0 },
            player2: { name: "", score: 0 },
            currentWord: null,
            difficulty: "",
            clues: [],
            turnsLeft: 4,
            timeLeft: 60,
            timer: null,
            startTime: null,
            isGuesser: false,
            currentGuesser: 1,
            isMyTurn: true
        };

        // Syst√®me de stockage avanc√©
        let userDatabase = JSON.parse(localStorage.getItem('leximarketUsers') || '{}');
        let rooms = JSON.parse(localStorage.getItem('leximarketRooms') || '{}');
        let matchmakingQueue = JSON.parse(localStorage.getItem('leximarketQueue') || '[]');
        let gameHistory = JSON.parse(localStorage.getItem('leximarketHistory') || '[]');
        let queueTimer = null;
        let queueStartTime = null;

        // Fonctions utilitaires
        function saveData() {
            localStorage.setItem('leximarketUsers', JSON.stringify(userDatabase));
            localStorage.setItem('leximarketWords', JSON.stringify(marketingVocabulary));
            localStorage.setItem('leximarketRooms', JSON.stringify(rooms));
            localStorage.setItem('leximarketQueue', JSON.stringify(matchmakingQueue));
            localStorage.setItem('leximarketHistory', JSON.stringify(gameHistory));
        }

        function generateRoomCode() {
            return Math.random().toString(36).substr(2, 8).toUpperCase();
        }

        function getRandomWord() {
            const difficulties = ['easy', 'medium', 'hard'];
            const difficulty = difficulties[Math.floor(Math.random() * difficulties.length)];
            const words = marketingVocabulary[difficulty];
            if (words.length === 0) {
                const allWords = [...marketingVocabulary.easy, ...marketingVocabulary.medium, ...marketingVocabulary.hard];
                if (allWords.length === 0) return null;
                const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                return { ...randomWord, difficulty: 'medium' };
            }
            const randomWord = words[Math.floor(Math.random() * words.length)];
            return { ...randomWord, difficulty };
        }

        function updateLeaderboard() {
            const leaderboard = Object.entries(userDatabase)
                .sort((a, b) => b[1].totalScore - a[1].totalScore)
                .slice(0, 5);
            
            const leaderboardHTML = leaderboard.map((user, index) => 
                `<div class="leaderboard-item">
                    <span>${index + 1}. ${user[0]}</span>
                    <span>${user[1].totalScore} pts</span>
                </div>`
            ).join('');
            
            document.getElementById('leaderboardList').innerHTML = leaderboardHTML || '<div class="leaderboard-item"><span>Aucun score encore</span></div>';
        }

        function updateUserStats() {
            if (!currentUser || !userDatabase[currentUser]) return;
            
            const userData = userDatabase[currentUser];
            document.getElementById('userTotalScore').textContent = userData.totalScore;
            document.getElementById('userGamesPlayed').textContent = userData.gamesPlayed;
            document.getElementById('userWordsGuessed').textContent = userData.wordsGuessed;
            
            const winRate = userData.gamesPlayed > 0 ? 
                Math.round((userData.wordsGuessed / userData.gamesPlayed) * 100) : 0;
            document.getElementById('userWinRate').textContent = winRate + '%';
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Fonctions d'authentification
        function login() {
            const userName = document.getElementById('userName').value.trim();
            const password = document.getElementById('userPassword').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            
            if (!userName || !password) {
                alert('Veuillez remplir le pseudo et le mot de passe');
                return;
            }
            
            if (userDatabase[userName]) {
                // Utilisateur existant
                if (userDatabase[userName].password !== password) {
                    alert('Mot de passe incorrect');
                    return;
                }
            } else {
                alert('Utilisateur non trouv√©. Cr√©ez un compte d\'abord.');
                return;
            }
            
            currentUser = userName;
            document.getElementById('currentPlayerName').textContent = userName;
            
            updateUserStats();
            updateLeaderboard();
            showScreen('lobbyScreen');
        }

        function register() {
            const userName = document.getElementById('userName').value.trim();
            const password = document.getElementById('userPassword').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            
            if (!userName || !password) {
                alert('Veuillez remplir le pseudo et le mot de passe');
                return;
            }
            
            if (userDatabase[userName]) {
                alert('Ce pseudo existe d√©j√†');
                return;
            }
            
            // Cr√©er le nouveau compte
            userDatabase[userName] = {
                password: password,
                email: email,
                totalScore: 0,
                gamesPlayed: 0,
                wordsGuessed: 0,
                createdAt: Date.now(),
                lastLogin: Date.now()
            };
            
            saveData();
            currentUser = userName;
            document.getElementById('currentPlayerName').textContent = userName;
            
            updateUserStats();
            updateLeaderboard();
            showScreen('lobbyScreen');
            alert('Compte cr√©√© avec succ√®s !');
        }

        function logout() {
            currentUser = null;
            document.getElementById('userName').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('userEmail').value = '';
            showScreen('loginScreen');
        }

        // Fonctions de matchmaking
        function startMatchmaking() {
            // Ajouter l'utilisateur √† la queue
            if (!matchmakingQueue.includes(currentUser)) {
                matchmakingQueue.push(currentUser);
                saveData();
            }
            
            queueStartTime = Date.now();
            updateQueueDisplay();
            showScreen('matchmakingScreen');
            
            // D√©marrer le timer de la queue
            queueTimer = setInterval(() => {
                updateQueueDisplay();
                
                // Simuler la recherche d'un adversaire
                if (Math.random() < 0.3 && (Date.now() - queueStartTime) > 3000) {
                    findMatch();
                }
            }, 1000);
        }

        function updateQueueDisplay() {
            const elapsed = Math.floor((Date.now() - queueStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('queueTimer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('queueCount').textContent = matchmakingQueue.length;
        }

        function findMatch() {
            clearInterval(queueTimer);
            
            // Retirer l'utilisateur de la queue
            matchmakingQueue = matchmakingQueue.filter(user => user !== currentUser);
            saveData();
            
            // Simuler un adversaire trouv√©
            const opponents = ['Alice', 'Bob', 'Charlie', 'Diana', 'Eve', 'Frank'];
            const opponent = opponents[Math.floor(Math.random() * opponents.length)];
            
            gameState.player1.name = currentUser;
            gameState.player2.name = opponent;
            gameState.player1.score = 0;
            gameState.player2.score = 0;
            
            alert(`Adversaire trouv√© : ${opponent} !`);
            startGameSession();
        }

        function cancelMatchmaking() {
            clearInterval(queueTimer);
            matchmakingQueue = matchmakingQueue.filter(user => user !== currentUser);
            saveData();
            showScreen('lobbyScreen');
        }

        // Fonctions d'entra√Ænement
        function startTraining() {
            isTrainingMode = true;
            gameState.player1.name = currentUser;
            gameState.player2.name = 'ü§ñ Bot LexiMarket';
            gameState.player1.score = 0;
            gameState.player2.score = 0;
            
            startGameSession();
        }

        function giveBotClue() {
            if (!isTrainingMode || !gameState.currentWord || !gameState.currentWord.botClues) return;
            
            const availableClues = gameState.currentWord.botClues.filter(clue => 
                !gameState.clues.includes(clue)
            );
            
            if (availableClues.length === 0) return;
            
            const randomClue = availableClues[Math.floor(Math.random() * availableClues.length)];
            
            setTimeout(() => {
                gameState.clues.push(randomClue);
                gameState.turnsLeft--;
                updateGameDisplay();
                
                // Ajouter visuellement l'indice du bot
                const cluesList = document.getElementById('cluesList');
                const lastClue = cluesList.lastElementChild;
                if (lastClue) {
                    lastClue.classList.add('bot-clue');
                }
                
                if (gameState.turnsLeft <= 0) {
                    endRound(false, "‚ùå Plus d'indices disponibles !");
                    return;
                }
                
                // Passer au mode devinette pour l'utilisateur
                document.getElementById('clueInputSection').style.display = 'none';
                document.getElementById('guessSection').style.display = 'block';
                document.getElementById('wordToGuess').textContent = `${gameState.currentWord.word.length} lettres`;
                document.getElementById('wordToGuess').classList.add('word-hidden');
            }, 1500 + Math.random() * 2000); // D√©lai r√©aliste pour le bot
        }

        // Fonctions d'administration
        function showAdminPanel() {
            updateWordList();
            showScreen('adminScreen');
        }

        function addWord() {
            const word = document.getElementById('newWord').value.trim().toUpperCase();
            const definition = document.getElementById('newDefinition').value.trim();
            const difficulty = document.getElementById('newDifficulty').value;
            
            const botClues = [
                document.getElementById('newClue1').value.trim(),
                document.getElementById('newClue2').value.trim(),
                document.getElementById('newClue3').value.trim(),
                document.getElementById('newClue4').value.trim()
            ].filter(clue => clue.length > 0);

            if (!word || !definition) {
                alert('Veuillez remplir au moins le mot et la d√©finition');
                return;
            }

            // V√©rifier si le mot existe d√©j√†
            const allWords = [...marketingVocabulary.easy, ...marketingVocabulary.medium, ...marketingVocabulary.hard];
            if (allWords.some(w => w.word === word)) {
                alert('Ce mot existe d√©j√† dans la base');
                return;
            }

            marketingVocabulary[difficulty].push({ 
                word, 
                definition, 
                botClues: botClues.length > 0 ? botClues : [word.toLowerCase().substring(0, 3), "myst√®re", "devinez", "concept"]
            });
            saveData();

            // R√©initialiser le formulaire
            document.getElementById('newWord').value = '';
            document.getElementById('newDefinition').value = '';
            document.getElementById('newDifficulty').value = 'easy';
            document.getElementById('newClue1').value = '';
            document.getElementById('newClue2').value = '';
            document.getElementById('newClue3').value = '';
            document.getElementById('newClue4').value = '';

            updateWordList();
            alert('Mot ajout√© avec succ√®s !');
        }

        function deleteWord(difficulty, index) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce mot ?')) {
                marketingVocabulary[difficulty].splice(index, 1);
                saveData();
                updateWordList();
            }
        }

        function updateWordList() {
            const wordListContainer = document.getElementById('wordList');
            let totalWords = 0;
            let html = '';

            ['easy', 'medium', 'hard'].forEach(difficulty => {
                const words = marketingVocabulary[difficulty];
                totalWords += words.length;
                
                words.forEach((wordObj, index) => {
                    html += `
                        <div class="word-item">
                            <div class="word-header">
                                <div class="word-text">${wordObj.word}</div>
                                <div>
                                    <span class="word-difficulty difficulty-${difficulty}">${difficulty.toUpperCase()}</span>
                                    <button class="btn btn-small btn-danger" onclick="deleteWord('${difficulty}', ${index})">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="word-definition">${wordObj.definition}</div>
                            <div class="word-clues">
                                <h5>Indices du bot :</h5>
                                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                    ${(wordObj.botClues || []).map(clue => `<span class="clue">${clue}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                });
            });

            wordListContainer.innerHTML = html || '<p style="text-align: center; color: #666;">Aucun mot dans la base</p>';
            document.getElementById('wordCount').textContent = totalWords;
        }

        function exportWords() {
            const dataStr = JSON.stringify(marketingVocabulary, null, 2);
            const dataBlob = new Blob([dataStr], {type:'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'leximarket_vocabulaire.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function importWords() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Veuillez s√©lectionner un fichier');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedWords = JSON.parse(e.target.result);
                    
                    if (!importedWords.easy || !importedWords.medium || !importedWords.hard) {
                        throw new Error('Format invalide');
                    }

                    if (confirm('Cette action remplacera tous les mots existants. Continuer ?')) {
                        marketingVocabulary = importedWords;
                        saveData();
                        updateWordList();
                        alert('Import r√©ussi !');
                    }
                } catch (error) {
                    alert('Erreur lors de l\'import : fichier invalide');
                }
            };
            reader.readAsText(file);
        }

        // Fonctions de salle priv√©e
        function createRoom() {
            const roomCode = generateRoomCode();
            currentRoom = roomCode;
            
            rooms[roomCode] = {
                players: [currentUser],
                gameState: 'waiting',
                createdAt: Date.now()
            };
            
            document.getElementById('displayRoomCode').textContent = roomCode;
            saveData();
            showScreen('waitingScreen');
            
            // Simuler l'arriv√©e d'un joueur apr√®s quelques secondes
            setTimeout(() => {
                if (document.getElementById('waitingScreen').classList.contains('active')) {
                    simulatePlayerJoin();
                }
            }, 5000);
        }

        function joinRoom() {
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            if (!roomCode) {
                alert('Veuillez entrer un code de salle');
                return;
            }
            
            if (!rooms[roomCode]) {
                alert('Code de salle invalide');
                return;
            }
            
            if (rooms[roomCode].players.length >= 2) {
                alert('Cette salle est pleine');
                return;
            }
            
            currentRoom = roomCode;
            rooms[roomCode].players.push(currentUser);
            saveData();
            
            startGameSession();
        }

        function simulatePlayerJoin() {
            const botNames = ['Emma', 'Lucas', 'Chloe', 'Nathan', 'Lea', 'Hugo', 'Camille', 'Arthur'];
            const botName = botNames[Math.floor(Math.random() * botNames.length)];
            
            if (rooms[currentRoom]) {
                rooms[currentRoom].players.push(botName);
                saveData();
                startGameSession();
            }
        }

        // Fonctions principales du jeu
        function startGameSession() {
            if (currentRoom && rooms[currentRoom]) {
                const players = rooms[currentRoom].players;
                gameState.player1.name = players[0];
                gameState.player2.name = players[1];
            }
            
            document.getElementById('player1Name').textContent = gameState.player1.name;
            document.getElementById('player2Name').textContent = gameState.player2.name;
            
            startNewRound();
            showScreen('gameScreen');
        }

        function startNewRound() {
            const wordData = getRandomWord();
            if (!wordData) {
                alert('Aucun mot disponible dans la base de donn√©es !');
                backToLobby();
                return;
            }
            
            gameState.currentWord = wordData;
            gameState.clues = [];
            gameState.turnsLeft = 4;
            gameState.timeLeft = 60;
            
            // Alterner qui donne les indices
            gameState.isMyTurn = gameState.currentGuesser === 1;
            gameState.isGuesser = gameState.currentGuesser === 1 && gameState.player1.name === currentUser;
            gameState.currentGuesser = gameState.currentGuesser === 1 ? 2 : 1;
            
            // Mise √† jour de l'interface
            updatePlayerTurnDisplay();
            
            document.getElementById('difficultyDisplay').innerHTML = 
                `<span class="difficulty-${wordData.difficulty}">Difficult√© : ${wordData.difficulty.toUpperCase()}</span>`;
            
            if (gameState.isGuesser || (!gameState.isMyTurn && !isTrainingMode)) {
                // Je suis le devineur ou ce n'est pas mon tour
                document.getElementById('wordToGuess').textContent = `${wordData.word.length} lettres`;
                document.getElementById('wordToGuess').classList.add('word-hidden');
                document.getElementById('clueInputSection').style.display = 'none';
                document.getElementById('guessSection').style.display = gameState.isGuesser ? 'block' : 'none';
            } else {
                // Je donne les indices
                document.getElementById('wordToGuess').textContent = wordData.word;
                document.getElementById('wordToGuess').classList.remove('word-hidden');
                document.getElementById('clueInputSection').style.display = 'block';
                document.getElementById('guessSection').style.display = 'none';
            }
            
            updateGameDisplay();
            startTimer();
            
            // Si c'est le mode entra√Ænement et que c'est au bot de donner un indice
            if (isTrainingMode && !gameState.isGuesser && !gameState.isMyTurn) {
                giveBotClue();
            }
        }

        function updatePlayerTurnDisplay() {
            const player1Info = document.getElementById('player1Info');
            const player2Info = document.getElementById('player2Info');
            
            player1Info.classList.remove('current-turn');
            player2Info.classList.remove('current-turn');
            
            if (gameState.currentGuesser === 1) {
                player2Info.classList.add('current-turn');
            } else {
                player1Info.classList.add('current-turn');
            }
        }

        function updateGameDisplay() {
            document.getElementById('turnsLeft').textContent = `Tours restants : ${gameState.turnsLeft}`;
            document.getElementById('player1Score').textContent = gameState.player1.score;
            document.getElementById('player2Score').textContent = gameState.player2.score;
            
            const cluesHTML = gameState.clues.map((clue, index) => {
                const isBot = isTrainingMode && gameState.currentWord.botClues && 
                              gameState.currentWord.botClues.includes(clue);
                return `<span class="clue ${isBot ? 'bot-clue' : ''}">${clue}</span>`;
            }).join('');
            document.getElementById('cluesList').innerHTML = cluesHTML;
            
            const timerElement = document.getElementById('timer');
            timerElement.textContent = gameState.timeLeft;
            if (gameState.timeLeft <= 10) {
                timerElement.classList.add('warning');
            } else {
                timerElement.classList.remove('warning');
            }
        }

        function startTimer() {
            gameState.startTime = Date.now();
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                updateGameDisplay();
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    endRound(false, "‚è∞ Temps √©coul√© !");
                }
            }, 1000);
        }

        function validateClue(clue, targetWord) {
            const cleanClue = clue.toLowerCase().trim();
            const cleanTarget = targetWord.toLowerCase();
            
            if (cleanClue.length < 2) return { valid: false, reason: "L'indice doit contenir au moins 2 caract√®res" };
            if (cleanClue.includes(' ')) return { valid: false, reason: "Un seul mot autoris√©" };
            if (cleanClue === cleanTarget) return { valid: false, reason: "L'indice ne peut pas √™tre le mot √† deviner" };
            
            if (cleanTarget.includes(cleanClue) || cleanClue.includes(cleanTarget.substring(0, 3))) {
                return { valid: false, reason: "L'indice est trop proche du mot √† deviner" };
            }
            
            if (gameState.clues.some(existingClue => existingClue.toLowerCase() === cleanClue)) {
                return { valid: false, reason: "Cet indice a d√©j√† √©t√© donn√©" };
            }
            
            return { valid: true };
        }

        function giveClue() {
            const clueInput = document.getElementById('clueInput');
            const clue = clueInput.value.trim();
            
            if (!clue) {
                alert('Veuillez entrer un indice');
                return;
            }
            
            const validation = validateClue(clue, gameState.currentWord.word);
            if (!validation.valid) {
                alert(validation.reason);
                return;
            }
            
            gameState.clues.push(clue);
            gameState.turnsLeft--;
            clueInput.value = '';
            
            updateGameDisplay();
            
            if (gameState.turnsLeft <= 0) {
                endRound(false, "‚ùå Plus d'indices disponibles !");
                return;
            }
            
            // Passer au mode devinette
            document.getElementById('clueInputSection').style.display = 'none';
            document.getElementById('guessSection').style.display = 'block';
            document.getElementById('wordToGuess').textContent = `${gameState.currentWord.word.length} lettres`;
            document.getElementById('wordToGuess').classList.add('word-hidden');
        }

        function makeGuess() {
            const guessInput = document.getElementById('guessInput');
            const guess = guessInput.value.trim().toLowerCase();
            
            if (!guess) {
                alert('Veuillez entrer votre r√©ponse');
                return;
            }
            
            if (guess === gameState.currentWord.word.toLowerCase()) {
                endRound(true, "üéâ Mot trouv√© !");
            } else {
                guessInput.value = '';
                alert('‚ùå Mauvaise r√©ponse, essayez encore !');
                if (gameState.turnsLeft <= 0) {
                    endRound(false, "‚ùå Plus d'indices disponibles !");
                } else {
                    skipTurn();
                }
            }
        }

        function skipTurn() {
            if (gameState.turnsLeft <= 0) {
                endRound(false, "‚ùå Plus d'indices disponibles !");
                return;
            }
            
            document.getElementById('clueInputSection').style.display = 'block';
            document.getElementById('guessSection').style.display = 'none';
            document.getElementById('wordToGuess').textContent = gameState.currentWord.word;
            document.getElementById('wordToGuess').classList.remove('word-hidden');
            document.getElementById('guessInput').value = '';
            
            // Si mode entra√Ænement, faire donner un indice au bot
            if (isTrainingMode) {
                giveBotClue();
            }
        }

        function calculateScore(timeUsed, cluesUsed, difficulty) {
            let baseScore = 100;
            const timeBonus = Math.max(0, 60 - timeUsed) * 2;
            const clueBonus = (4 - cluesUsed) * 25;
            const difficultyMultiplier = { easy: 1, medium: 1.5, hard: 2 };
            const difficultyBonus = Math.round(baseScore * (difficultyMultiplier[difficulty] - 1));
            
            return Math.round(baseScore + timeBonus + clueBonus + difficultyBonus);
        }

        function endRound(success, message) {
            clearInterval(gameState.timer);
            
            const timeUsed = Math.round((Date.now() - gameState.startTime) / 1000);
            let pointsEarned = 0;
            
            if (success) {
                pointsEarned = calculateScore(timeUsed, gameState.clues.length, gameState.currentWord.difficulty);
                gameState.player1.score += pointsEarned;
                gameState.player2.score += pointsEarned;
                
                // Mettre √† jour la base de donn√©es utilisateur
                if (currentUser && userDatabase[currentUser]) {
                    userDatabase[currentUser].totalScore += pointsEarned;
                    userDatabase[currentUser].wordsGuessed++;
                    userDatabase[currentUser].lastLogin = Date.now();
                }
                
                // Enregistrer l'historique du jeu
                gameHistory.push({
                    player: currentUser,
                    opponent: gameState.player2.name,
                    word: gameState.currentWord.word,
                    success: success,
                    timeUsed: timeUsed,
                    cluesUsed: gameState.clues.length,
                    pointsEarned: pointsEarned,
                    difficulty: gameState.currentWord.difficulty,
                    mode: isTrainingMode ? 'training' : 'multiplayer',
                    timestamp: Date.now()
                });
                
                saveData();
            }
            
            // Afficher les r√©sultats
            document.getElementById('resultTitle').textContent = success ? "üéâ Mot trouv√© !" : "‚ùå √âchec";
            document.getElementById('resultMessage').innerHTML = `
                ${message}<br>
                <strong>Le mot √©tait : ${gameState.currentWord.word}</strong><br>
                <em>${gameState.currentWord.definition}</em>
            `;
            document.getElementById('timeUsed').textContent = `${timeUsed}s`;
            document.getElementById('cluesUsed').textContent = `${gameState.clues.length}/4`;
            
            const difficultyBonusValue = Math.round(100 * ({ easy: 0, medium: 0.5, hard: 1 }[gameState.currentWord.difficulty]));
            document.getElementById('difficultyBonus').textContent = `+${difficultyBonusValue}`;
            document.getElementById('pointsEarned').textContent = `${pointsEarned}`;
            
            showScreen('resultsScreen');
        }

        function nextRound() {
            startNewRound();
            showScreen('gameScreen');
        }

        function backToLobby() {
            if (currentUser && userDatabase[currentUser]) {
                userDatabase[currentUser].gamesPlayed++;
                saveData();
                updateLeaderboard();
                updateUserStats();
            }
            
            // Nettoyer
            if (currentRoom && rooms[currentRoom]) {
                delete rooms[currentRoom];
                saveData();
            }
            currentRoom = null;
            isTrainingMode = false;
            
            showScreen('lobbyScreen');
        }

        function backToLogin() {
            showScreen('loginScreen');
        }

        function endGame() {
            if (confirm('√ätes-vous s√ªr de vouloir abandonner la partie ?')) {
                clearInterval(gameState.timer);
                backToLobby();
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateLeaderboard();
            
            // Gestion des touches Entr√©e
            document.getElementById('userName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            document.getElementById('userPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            document.getElementById('roomCodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') joinRoom();
            });
            
            document.getElementById('clueInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') giveClue();
            });
            
            document.getElementById('guessInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') makeGuess();
            });
            
            document.getElementById('newWord').addEventListener('input', function(e) {
                e.target.value = e.target.value.toUpperCase();
            });
            
            // Nettoyage p√©riodique
            setInterval(() => {
                const now = Date.now();
                Object.keys(rooms).forEach(roomCode => {
                    if (now - rooms[roomCode].createdAt > 3600000) {
                        delete rooms[roomCode];
                    }
                });
                
                // Nettoyer la queue de matchmaking
                if (matchmakingQueue.length > 10) {
                    matchmakingQueue = matchmakingQueue.slice(-5);
                }
                
                saveData();
            }, 300000);
        });
    </script>
</body>
</html>
</body>
</html>
