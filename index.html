<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexiMarket - Multijoueur Temps Réel</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 900px;
            width: 90%;
            min-height: 600px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .connection-status {
            position: absolute;
            top: 0;
            right: 0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .connected {
            background: #d4edda;
            color: #155724;
        }

        .disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .game-modes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .game-mode {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-mode:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .game-mode h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .game-mode p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .queue-status {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .queue-timer {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .queue-info {
            color: #666;
            margin: 10px 0;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .player {
            text-align: center;
        }

        .player h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .player .score {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .current-turn {
            background: #d4edda !important;
            border-left: 4px solid #28a745;
        }

        .word-to-guess {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 12px;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-align: center;
        }

        .word-hidden {
            background: #e1e5e9;
            color: #666;
        }

        .timer {
            font-size: 48px;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 20px;
            text-align: center;
        }

        .timer.warning {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .clues-section, .guess-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .clues-list {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .clue {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
        }

        .turns-left {
            font-size: 18px;
            color: #e74c3c;
            margin-bottom: 10px;
            text-align: center;
        }

        .difficulty-display {
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
        }

        .difficulty-easy { color: #28a745; }
        .difficulty-medium { color: #fd7e14; }
        .difficulty-hard { color: #dc3545; }

        .status-message {
            text-align: center;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .results {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .score-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }
            
            .player-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .score-breakdown, .game-modes {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>🎯 LexiMarket</h1>
            <p>Multijoueur temps réel - BTS MCO</p>
            <div class="connection-status" id="connectionStatus">
                🔴 Déconnecté
            </div>
        </div>

        <!-- Écran de connexion -->
        <div class="screen active" id="loginScreen">
            <div style="max-width: 400px; margin: 0 auto;">
                <h2 style="text-align: center; margin-bottom: 20px;">Connexion</h2>
                
                <div class="form-group">
                    <label for="userName">Pseudo :</label>
                    <input type="text" id="userName" placeholder="Votre pseudo">
                </div>
                
                <div class="form-group">
                    <label for="userPassword">Mot de passe :</label>
                    <input type="password" id="userPassword" placeholder="Votre mot de passe">
                </div>
                
                <div class="form-group">
                    <label for="userEmail">Email (optionnel) :</label>
                    <input type="email" id="userEmail" placeholder="votre@email.com">
                </div>
                
                <button class="btn" onclick="login()" id="loginBtn">Se connecter</button>
                
                <div id="statusMessage" class="status-message" style="display: none;"></div>
            </div>
        </div>

        <!-- Écran du lobby -->
        <div class="screen" id="lobbyScreen">
            <div style="max-width: 600px; margin: 0 auto;">
                <h2 style="text-align: center;">Bienvenue, <span id="currentPlayerName"></span>!</h2>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="userTotalScore">0</div>
                        <div class="stat-label">Points</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="userGamesPlayed">0</div>
                        <div class="stat-label">Parties</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="userWordsGuessed">0</div>
                        <div class="stat-label">Mots trouvés</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="connectedUsers">0</div>
                        <div class="stat-label">Connectés</div>
                    </div>
                </div>
                
                <div class="game-modes">
                    <div class="game-mode" onclick="startMatchmaking()">
                        <h3>⚡ Matchmaking</h3>
                        <p>Trouvez un adversaire automatiquement</p>
                        <div class="queue-info">
                            <small>En file: <span id="queueCount">0</span> joueurs</small>
                        </div>
                        <button class="btn btn-success">Chercher un match</button>
                    </div>
                    
                    <div class="game-mode" onclick="startTraining()">
                        <h3>🤖 Entraînement</h3>
                        <p>Jouez contre l'IA pour vous entraîner</p>
                        <button class="btn btn-warning">S'entraîner</button>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <h3>🏠 Salle privée</h3>
                    <div class="form-group">
                        <input type="text" id="roomCodeInput" placeholder="Code de salle" style="max-width: 200px; margin: 0 auto;">
                    </div>
                    <button class="btn btn-secondary" onclick="createPrivateRoom()">Créer une salle</button>
                    <button class="btn btn-secondary" onclick="joinPrivateRoom()">Rejoindre</button>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="logout()">Déconnexion</button>
                </div>
            </div>
        </div>

        <!-- Écran de matchmaking -->
        <div class="screen" id="matchmakingScreen">
            <div class="queue-status">
                <h2>🔍 Recherche d'adversaire...</h2>
                <div class="queue-timer" id="queueTimer">0:00</div>
                <div class="queue-info">
                    <p>Position dans la file : <span id="queuePosition">1</span></p>
                    <p>Temps d'attente estimé : <span id="estimatedWait">~30s</span></p>
                </div>
                <div style="margin: 20px 0;">
                    <div style="background: #e9ecef; height: 6px; border-radius: 3px;">
                        <div id="queueProgress" style="background: #667eea; height: 100%; border-radius: 3px; width: 0%; transition: width 1s;"></div>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="cancelMatchmaking()">Annuler</button>
            </div>
        </div>

        <!-- Écran de jeu -->
        <div class="screen" id="gameScreen">
            <div class="player-info">
                <div class="player" id="player1Info">
                    <h3 id="player1Name">Joueur 1</h3>
                    <div class="score" id="player1Score">0</div>
                </div>
                <div class="player" id="player2Info">
                    <h3 id="player2Name">Joueur 2</h3>
                    <div class="score" id="player2Score">0</div>
                </div>
            </div>

            <div class="difficulty-display" id="difficultyDisplay"></div>
            <div class="timer" id="timer">60</div>
            <div class="word-to-guess" id="wordToGuess">En attente...</div>
            
            <div class="turns-left" id="turnsLeft">Tours restants : 4</div>
            
            <div class="clues-section" id="cluesSection">
                <h3>Indices donnés :</h3>
                <div class="clues-list" id="cluesList"></div>
                
                <div class="form-group" id="clueInputSection" style="display: none;">
                    <input type="text" id="clueInput" placeholder="Donnez un indice (un seul mot)" maxlength="25">
                    <button class="btn" onclick="giveClue()">Donner l'indice</button>
                </div>
            </div>

            <div class="guess-section" id="guessSection" style="display: none;">
                <h3>À vous de deviner !</h3>
                <div class="form-group">
                    <input type="text" id="guessInput" placeholder="Votre réponse">
                </div>
                <button class="btn btn-success" onclick="makeGuess()">Deviner</button>
            </div>

            <div id="gameStatus" class="status-message" style="display: none;"></div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-danger" onclick="leaveGame()">Quitter la partie</button>
            </div>
        </div>

        <!-- Écran de résultats -->
        <div class="screen" id="resultsScreen">
            <div class="results">
                <h2 id="resultTitle">Résultat de la manche</h2>
                <p id="resultMessage">En attente...</p>
                
                <div class="score-breakdown">
                    <div class="score-item">
                        <h4>Temps utilisé</h4>
                        <p id="timeUsed">0s</p>
                    </div>
                    <div class="score-item">
                        <h4>Indices utilisés</h4>
                        <p id="cluesUsed">0/4</p>
                    </div>
                    <div class="score-item">
                        <h4>Points gagnés</h4>
                        <p id="pointsEarned">0</p>
                    </div>
                    <div class="score-item">
                        <h4>Score total</h4>
                        <p id="totalScore">0</p>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <p><strong>Le mot était : <span id="revealedWord"></span></strong></p>
                    <p><em id="wordDefinition"></em></p>
                </div>
                
                <button class="btn" onclick="waitingNextRound()" id="nextRoundBtn">Manche suivante dans <span id="nextRoundCountdown">5</span>s</button>
                <button class="btn btn-secondary" onclick="backToLobby()">Retour au lobby</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let socket = null;
        let currentUser = null;
        let currentRoom = null;
        let isTrainingMode = false;
        let queueStartTime = null;
        let queueTimer = null;
        let nextRoundTimer = null;

        // Initialisation de la connexion WebSocket
        function initSocket() {
            socket = io();
            
            socket.on('connect', () => {
                showStatus('connected', '🟢 Connecté');
                console.log('Connecté au serveur');
            });
            
            socket.on('disconnect', () => {
                showStatus('disconnected', '🔴 Déconnecté');
                console.log('Déconnecté du serveur');
            });
            
            // Événements d'authentification
            socket.on('login_success', (data) => {
                currentUser = data.userData.pseudo;
                updateUserStats(data.userData);
                document.getElementById('currentPlayerName').textContent = currentUser;
                document.getElementById('connectedUsers').textContent = data.connectedUsers;
                showScreen('lobbyScreen');
                showMessage('success', 'Connexion réussie !');
            });
            
            socket.on('leaderboard_update', (leaderboard) => {
                updateLeaderboard(leaderboard);
            });
            
            // Événements de matchmaking
            socket.on('matchmaking_joined', (data) => {
                document.getElementById('queuePosition').textContent = data.queuePosition;
                document.getElementById('estimatedWait').textContent = `~${data.estimatedWait}s`;
                showScreen('matchmakingScreen');
                startQueueTimer();
            });
            
            socket.on('match_found', (data) => {
                clearInterval(queueTimer);
                currentRoom = data.roomCode;
                showMessage('success', `Match trouvé contre ${data.opponent} !`);
                
                setTimeout(() => {
                    socket.emit('join_room', data.roomCode);
                }, 2000);
            });
            
            socket.on('matchmaking_left', () => {
                clearInterval(queueTimer);
                showScreen('lobbyScreen');
            });
            
            socket.on('queue_update', (data) => {
                document.getElementById('queueCount').textContent = data.playersInQueue;
            });
            
            // Événements de jeu
            socket.on('game_start', (data) => {
                setupGame(data);
                showScreen('gameScreen');
            });
            
            socket.on('room_joined', (data) => {
                currentRoom = data.roomCode;
                if (data.gameState === 'playing') {
                    setupGame(data);
                    showScreen('gameScreen');
                }
            });
            
            socket.on('clue_given', (data) => {
                updateCluesList(data.clues);
                updateTurnsLeft(data.turnsLeft);
                showGameStatus(`${data.giver} a donné l'indice : "${data.clue}"`);
            });
            
            socket.on('timer_update', (timeLeft) => {
                updateTimer(timeLeft);
            });
            
            socket.on('round_end', (data) => {
                showResults(data);
            });
            
            socket.on('next_round', (data) => {
                setupGame(data);
                showScreen('gameScreen');
            });
            
            socket.on('player_disconnected', (playerName) => {
                showGameStatus(`${playerName} s'est déconnecté`, 'error');
            });
            
            // Événements d'erreur
            socket.on('room_error', (message) => {
                showMessage('error', message);
            });
            
            socket.on('clue_error', (message) => {
                showMessage('error', message);
            });
            
            socket.on('guess_wrong', (message) => {
                showMessage('error', 'Mauvaise réponse !');
                document.getElementById('guessInput').value = '';
            });
        }

        // Fonctions d'interface
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showStatus(type, message) {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.textContent = message;
            statusEl.className = `connection-status ${type}`;
        }

        function showMessage(type, message) {
            const messageEl = document.getElementById('statusMessage');
            messageEl.textContent = message;
            messageEl.className = `status-message status-${type}`;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }

        function showGameStatus(message, type = 'info') {
            const statusEl = document.getElementById('gameStatus');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }

        // Fonctions d'authentification
        function login() {
            const userName = document.getElementById('userName').value.trim();
            const password = document.getElementById('userPassword').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            
            if (!userName || !password) {
                showMessage('error', 'Veuillez remplir le pseudo et le mot de passe');
                return;
            }
            
            document.getElementById('loginBtn').disabled = true;
            
            socket.emit('user_login', {
                pseudo: userName,
                password: password,
                email: email
            });
        }

        function logout() {
            if (socket) {
                socket.disconnect();
            }
            currentUser = null;
            currentRoom = null;
            document.getElementById('userName').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('userEmail').value = '';
            showScreen('loginScreen');
            initSocket();
        }

        // Fonctions de matchmaking
        function startMatchmaking() {
            socket.emit('join_matchmaking');
        }

        function cancelMatchmaking() {
            socket.emit('leave_matchmaking');
        }

        function startQueueTimer() {
            queueStartTime = Date.now();
            queueTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - queueStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                
                document.getElementById('queueTimer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Mise à jour de la barre de progression
                const progress = Math.min((elapsed / 60) * 100, 100);
                document.getElementById('queueProgress').style.width = progress + '%';
            }, 1000);
        }

        // Fonctions de jeu
        function startTraining() {
            isTrainingMode = true;
            showMessage('info', 'Mode entraînement non encore implémenté');
        }

        function createPrivateRoom() {
            socket.emit('create_private_room');
        }

        function joinPrivateRoom() {
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            if (!roomCode) {
                showMessage('error', 'Veuillez entrer un code de salle');
                return;
            }
            
            socket.emit('join_private_room', roomCode);
        }

        function setupGame(data) {
            document.getElementById('player1Name').textContent = data.players[0];
            document.getElementById('player2Name').textContent = data.players[1];
            
            if (data.word) {
                document.getElementById('difficultyDisplay').innerHTML = 
                    `<span class="difficulty-${data.word.difficulty}">Difficulté : ${data.word.difficulty.toUpperCase()}</span>`;
                
                // Déterminer si je suis le donneur d'indices ou le devineur
                const isGuesser = data.currentGuesser === 1 ? 
                    data.players[0] === currentUser : 
                    data.players[1] === currentUser;
                
                if (isGuesser) {
                    document.getElementById('wordToGuess').textContent = `${data.word.word.length} lettres`;
                    document.getElementById('wordToGuess').classList.add('word-hidden');
                    document.getElementById('clueInputSection').style.display = 'none';
                    document.getElementById('guessSection').style.display = 'block';
                } else {
                    document.getElementById('wordToGuess').textContent = data.word.word;
                    document.getElementById('wordToGuess').classList.remove('word-hidden');
                    document.getElementById('clueInputSection').style.display = 'block';
                    document.getElementById('guessSection').style.display = 'none';
                }
            }
            
            updateCluesList(data.clues || []);
            updateTurnsLeft(data.turnsLeft || 4);
            updateTimer(data.timeLeft || 60);
            updateScores(data.scores || {});
        }

        function giveClue() {
            const clueInput = document.getElementById('clueInput');
            const clue = clueInput.value.trim();
            
            if (!clue) {
                showMessage('error', 'Veuillez entrer un indice');
                return;
            }
            
            socket.emit('give_clue', {
                roomCode: currentRoom,
                clue: clue
            });
            
            clueInput.value = '';
        }

        function makeGuess() {
            const guessInput = document.getElementById('guessInput');
            const guess = guessInput.value.trim();
            
            if (!guess) {
                showMessage('error', 'Veuillez entrer votre réponse');
                return;
            }
            
            socket.emit('make_guess', {
                roomCode: currentRoom,
                guess: guess
            });
        }

        function leaveGame() {
            if (confirm('Êtes-vous sûr de vouloir quitter la partie ?')) {
                socket.emit('leave_room', currentRoom);
                currentRoom = null;
                showScreen('lobbyScreen');
            }
        }

        // Fonctions de mise à jour de l'interface
        function updateUserStats(userData) {
            document.getElementById('userTotalScore').textContent = userData.totalScore;
            document.getElementById('userGamesPlayed').textContent = userData.gamesPlayed;
            document.getElementById('userWordsGuessed').textContent = userData.wordsGuessed;
        }

        function updateCluesList(clues) {
            const cluesHTML = clues.map(clue => `<span class="clue">${clue}</span>`).join('');
            document.getElementById('cluesList').innerHTML = cluesHTML;
        }

        function updateTurnsLeft(turns) {
            document.getElementById('turnsLeft').textContent = `Tours restants : ${turns}`;
        }

        function updateTimer(timeLeft) {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = timeLeft;
            
            if (timeLeft <= 10) {
                timerEl.classList.add('warning');
            } else {
                timerEl.classList.remove('warning');
            }
        }

        function updateScores(scores) {
            const players = Object.keys(scores);
            if (players.length >= 2) {
                document.getElementById('player1Score').textContent = scores[players[0]] || 0;
                document.getElementById('player2Score').textContent = scores[players[1]] || 0;
            }
        }

        function showResults(data) {
            document.getElementById('resultTitle').textContent = data.success ? '🎉 Mot trouvé !' : '❌ Échec';
            document.getElementById('resultMessage').textContent = data.message;
            document.getElementById('timeUsed').textContent = `${data.timeUsed}s`;
            document.getElementById('cluesUsed').textContent = `${data.cluesUsed}/4`;
            document.getElementById('pointsEarned').textContent = data.pointsEarned;
            document.getElementById('revealedWord').textContent = data.word;
            document.getElementById('wordDefinition').textContent = data.definition;
            
            const myScore = data.scores[currentUser] || 0;
            document.getElementById('totalScore').textContent = myScore;
            
            showScreen('resultsScreen');
            startNextRoundCountdown();
        }

        function startNextRoundCountdown() {
            let countdown = 5;
            const btn = document.getElementById('nextRoundBtn');
            const countdownSpan = document.getElementById('nextRoundCountdown');
            
            btn.disabled = true;
            
            nextRoundTimer = setInterval(() => {
                countdown--;
                countdownSpan.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(nextRoundTimer);
                    btn.textContent = 'Manche suivante';
                    btn.disabled = false;
                }
            }, 1000);
        }

        function waitingNextRound() {
            showGameStatus('En attente de la prochaine manche...');
            showScreen('gameScreen');
        }

        function backToLobby() {
            if (currentRoom) {
                socket.emit('leave_room', currentRoom);
                currentRoom = null;
            }
            showScreen('lobbyScreen');
        }

        function updateLeaderboard(leaderboard) {
            // Fonction pour mettre à jour le leaderboard si nécessaire
            console.log('Leaderboard updated:', leaderboard);
        }

        // Gestion des événements clavier
        document.addEventListener('DOMContentLoaded', function() {
            initSocket();
            
            document.getElementById('userName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            document.getElementById('userPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            document.getElementById('roomCodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') joinPrivateRoom();
            });
            
            document.getElementById('clueInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') giveClue();
            });
            
            document.getElementById('guessInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') makeGuess();
            });
        });
    </script>
</body>
</html>
